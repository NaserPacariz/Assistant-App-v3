
<div class="task-management-container">
  <div class="back-arrow-container">
    <button class="back-arrow" (click)="goBack()">&larr;</button>
  </div>
  <h1 class="page-title">Manage user tasks</h1>

  <!-- Task Items Section -->
  <div class="task-list" *ngIf="tasks.length > 0">
    <table class="tasks-table">
      <thead>
        <tr>
          <th>Title</th>
          <th>Start Date</th>
          <th>End Date</th>
          <th>Stage</th>
          <th>Labels</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let task of tasks">
          <td>{{ task.title || 'Untitled' }}</td>
          <td>{{ task.startDate || 'No Start Date' }}</td>
          <td>{{ task.endDate || 'No End Date' }}</td>
          <td>
            <span class="stage-badge">{{ task.stage || 'No Stage' }}</span>
          </td>
          <td>
            <div class="labels">
              <span *ngFor="let label of task.labels" class="label-badge">
                {{ label }}
              </span>
            </div>
          </td>
          <td class="task-actions">
            <button class="btn btn-info" (click)="viewDescription(task)">
              View Description
            </button>
            <button class="btn btn-warning" (click)="openEditTaskModal(task)">
              Edit
            </button>
            <button class="btn btn-danger" (click)="confirmAndDeleteTask(task.id)">
              Delete
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="modal" *ngIf="isDescriptionModalVisible">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Task Description</h3>
        <span class="close-button" (click)="closeDescriptionModal()">&times;</span>
      </div>
      <div class="modal-body">
        <p>{{ selectedTaskDescription }}</p>
      </div>
    </div>
  </div>

  <div class="budget-management-container">
    <h2>Budget Management</h2>
  
    <!-- Add Budget Form -->
    <form (ngSubmit)="addBudget()" #addBudgetForm="ngForm" class="budget-form">
      <div class="form-group">
        <label for="amount">Budget Amount</label>
        <input
          type="number"
          id="amount"
          [(ngModel)]="amount"
          name="amount"
          placeholder="Enter Budget Amount"
          required
          #amountInput="ngModel"
        />
        <p class="error-message" *ngIf="amountInput.invalid && amountInput.touched">
          Budget amount is required and must be greater than 0.
        </p>
      </div>
      <div class="form-group">
        <label for="month">Select Month</label>
        <input
          type="month"
          id="month"
          [(ngModel)]="month"
          name="month"
          [value]="currentMonth"
          required
        />
      </div>
      <button type="submit" class="btn btn-success" [disabled]="addBudgetForm.invalid || loading">
        Add Budget
      </button>
    </form>
  
    <!-- Deduct Budget Form -->
    <form (ngSubmit)="deductBudget()" #deductBudgetForm="ngForm" class="budget-form">
      <div class="form-group">
        <label for="deduction">Deduction Amount</label>
        <input
          type="number"
          id="deduction"
          [(ngModel)]="deduction"
          name="deduction"
          placeholder="Enter Deduction Amount"
          required
          #deductionInput="ngModel"
        />
        <p class="error-message" *ngIf="deductionInput.invalid && deductionInput.touched">
          Deduction amount is required and must be greater than 0.
        </p>
      </div>
      <div class="form-group">
        <label for="deductMonth">Select Month</label>
        <input
          type="month"
          id="deductMonth"
          [(ngModel)]="deductionMonth"
          name="deductMonth"
          [value]="currentMonth"
          required
        />
      </div>
      <button type="submit" class="btn btn-warning" [disabled]="deductBudgetForm.invalid || loading">
        Deduct Budget
      </button>
    </form>
    
  
  
  <!-- No Tasks Message -->
  <p *ngIf="tasks.length === 0" class="no-tasks-message">No tasks available for this user.</p>
  

  <!-- Add Task Modal -->
  <div class="modal" *ngIf="isAddTaskModalVisible">
    <div class="modal-content">
      <span class="close-button" (click)="closeAddTaskModal()">&times;</span>
      <h3>Add a New Task</h3>
      <form (ngSubmit)="addTask()">
        <div class="form-group">
          <label for="taskTitle">Task Title</label>
          <input id="taskTitle" type="text" [(ngModel)]="taskTitle" name="taskTitle" required />
        </div>
        <div class="form-group">
          <label for="taskDescription">Task Description</label>
          <textarea id="taskDescription" [(ngModel)]="taskDescription" name="taskDescription" required></textarea>
        </div>
        <div class="form-group">
          <label for="dueDate">Due Date</label>
          <input id="dueDate" type="date" [(ngModel)]="dueDate" name="dueDate" required />
        </div>
        <div class="form-group">
          <label for="urgency">Urgency</label>
          <select id="urgency" [(ngModel)]="urgency" name="urgency" required>
            <option value="high">High</option>
            <option value="medium">Medium</option>
            <option value="low">Low</option>
          </select>
        </div>
        <div class="form-actions">
          <button type="submit" class="btn btn-success">Save</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Edit Task Modal -->
  <div class="modal" *ngIf="isEditModalOpen">
    <div class="modal-content">
      <div class="modal-header">
        <div class="header-icon">
          <i class="fas fa-tasks"></i>
        </div>
        <input
          type="text"
          [(ngModel)]="editingTask.title"
          class="task-title-input"
          placeholder="Name of task"
        />
        <button class="close-button" (click)="closeEditTaskModal()">
          <i class="fas fa-times">X</i>
        </button>
      </div>
      <form (ngSubmit)="updateTask()" class="edit-task-form">
        <div class="form-group">
          <label for="dueDate">Due Date</label>
          <input
            id="dueDate"
            type="date"
            [(ngModel)]="editingTask.dueDate"
            name="dueDate"
            required
          />
        </div>
        <div class="form-group">
          <label for="urgency">Urgency</label>
          <select id="urgency" [(ngModel)]="editingTask.urgency" name="urgency" required>
            <option value="high">High (Red)</option>
            <option value="medium">Medium (Yellow)</option>
            <option value="low">Low (Green)</option>
          </select>
        </div>
        <div class="form-group">
          <label for="description">Task Description</label>
          <textarea
            id="description"
            [(ngModel)]="editingTask.description"
            name="description"
            placeholder="Enter task description"
            required
          ></textarea>
        </div>
        <button type="submit" class="btn btn-success">Update</button>
      </form>
    </div>
  </div>
  
</div>